# üë§ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ IAM –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–ª—è Terraform

## üéØ –ß–æ–º—É –Ω–æ–≤–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á?

**–ü—Ä–æ–±–ª–µ–º–∞ –∑ –ø–æ—Ç–æ—á–Ω–∏–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º:**
- –Ñ explicit deny –ø–æ–ª—ñ—Ç–∏–∫–∏ —è–∫—ñ –±–ª–æ–∫—É—é—Ç—å S3 –¥–æ—Å—Ç—É–ø
- –û–±–º–µ–∂—É–≤–∞–ª—å–Ω—ñ –ø–æ–ª—ñ—Ç–∏–∫–∏ students/basic-user
- –°–∫–ª–∞–¥–Ω–æ –≤–∏–∑–Ω–∞—á–∏—Ç–∏ –¥–∂–µ—Ä–µ–ª–æ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è

**–†—ñ—à–µ–Ω–Ω—è:**
–°—Ç–≤–æ—Ä–∏—Ç–∏ —á–∏—Å—Ç–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ –¥–ª—è Terraform

## üìã –ü–æ–∫—Ä–æ–∫–æ–≤–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è

### –ö—Ä–æ–∫ 1: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

#### 1.1 –ü–æ—á–∞—Ç–æ–∫ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
1. **AWS Console** ‚Üí –ü–æ—à—É–∫ **"IAM"** ‚Üí IAM —Å–µ—Ä–≤—ñ—Å
2. **Users** ‚Üí **Create user**

![–ö—Ä–æ–∫ 1.1: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞](../Screens/1.1_create_user.png)

#### 1.2 –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
1. **User name**: `sk-terraform-user`
2. **Provide user access to the AWS Management Console**: –º–æ–∂–µ—Ç–µ –Ω–µ —Å—Ç–∞–≤–∏—Ç–∏ –≥–∞–ª–æ—á–∫—É (–Ω–∞–º –ø–æ—Ç—Ä—ñ–±–µ–Ω —Ç—ñ–ª—å–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–Ω–∏–π –¥–æ—Å—Ç—É–ø)
3. **Next**

![–ö—Ä–æ–∫ 1.2: –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —ñ–º–µ–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞](../Screens/1.2_create_user.png)

#### 1.3 –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø—É
1. **Set permissions options**: –û–±–µ—Ä—ñ—Ç—å **"Attach policies directly"**
2. **Next**

![–ö—Ä–æ–∫ 1.3: –í–∏–±—ñ—Ä —Å–ø–æ—Å–æ–±—É –Ω–∞–¥–∞–Ω–Ω—è –ø—Ä–∞–≤](../Screens/1.3_create_user.png)

#### 1.4 –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
1. **Review** –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
2. **Create user**

![–ö—Ä–æ–∫ 1.4: –†–µ–∑—É–ª—å—Ç–∞—Ç —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞](../Screens/1.4_create_user_result.png)

### –ö—Ä–æ–∫ 2: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–æ–ª—ñ—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø—É

#### 2.1 –°—Ç–≤–æ—Ä–µ–Ω–Ω—è IAM Policy
1. **IAM** ‚Üí **Policies** ‚Üí **Create policy**
2. **JSON** —Ç–∞–± ‚Üí –í—Å—Ç–∞–≤–∏—Ç–∏ –ø–æ–ª—ñ—Ç–∏–∫—É:

```json
{
	"Version": "2012-10-17",
	"Statement": [
		{
			"Sid": "AllowListingBucketsInConsole",
			"Effect": "Allow",
			"Action": "s3:ListAllMyBuckets",
			"Resource": "*"
		},
		{
			"Sid": "AllowAccessToThisBucketOnly",
			"Effect": "Allow",
			"Action": [
				"s3:GetBucketLocation",
				"s3:ListBucket"
			],
			"Resource": "arn:aws:s3:::terraform-state-danit10-devops"
		},
		{
			"Sid": "AllowObjectsCRUDInThisBucket",
			"Effect": "Allow",
			"Action": [
				"s3:GetObject",
				"s3:PutObject",
				"s3:DeleteObject"
			],
			"Resource": "arn:aws:s3:::terraform-state-danit10-devops/*"
		}
	]
}
```

![–ö—Ä–æ–∫ 2.1: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ—ó –ø–æ–ª—ñ—Ç–∏–∫–∏](../Screens/4.1_create_policy.png)

#### 2.2 –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–æ–ª—ñ—Ç–∏–∫–∏
1. –ù–∞–∑–≤—ñ—Ç—å –ø–æ–ª—ñ—Ç–∏–∫—É: `S3AccessOnlyToSvitlanaKizilpinarBucket`
2. –î–æ–¥–∞–π—Ç–µ –æ–ø–∏—Å: `–î–æ—Å—Ç—É–ø —Ç—ñ–ª—å–∫–∏ –¥–æ S3 bucket –¥–ª—è Terraform backend`
3. **Next**

![–ö—Ä–æ–∫ 2.2: JSON –ø–æ–ª—ñ—Ç–∏–∫–∞ –¥–æ—Å—Ç—É–ø—É](../Screens/4.2_create_policy.png)

### –ö—Ä–æ–∫ 3: –ü—Ä–∏–∫—Ä—ñ–ø–ª–µ–Ω–Ω—è –ø–æ–ª—ñ—Ç–∏–∫–∏ –¥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

#### 3.1 –î–æ–¥–∞–≤–∞–Ω–Ω—è –ø—Ä–∞–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É
1. **IAM** ‚Üí **Users** ‚Üí `sk-terraform-user`
2. **Permissions** ‚Üí **Add permissions**

![–ö—Ä–æ–∫ 3.1: –î–æ–¥–∞–≤–∞–Ω–Ω—è –ø—Ä–∞–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É](../Screens/4.3_add_policy_user.png)

#### 3.2 –í–∏–±—ñ—Ä –ø–æ–ª—ñ—Ç–∏–∫–∏
1. **Attach policies directly**
2. –ó–Ω–∞–π—Ç–∏ —Å—Ç–≤–æ—Ä–µ–Ω—É –ø–æ–ª—ñ—Ç–∏–∫—É
3. **Next**

![–ö—Ä–æ–∫ 3.2: –í–∏–±—ñ—Ä –ø–æ–ª—ñ—Ç–∏–∫–∏ –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞](../Screens/4.4_add_policy_user.png)

#### 3.3 –†–µ–∑—É–ª—å—Ç–∞—Ç
![–ö—Ä–æ–∫ 3.3: –ü–æ–ª—ñ—Ç–∏–∫–∞ –¥–æ–¥–∞–Ω–∞ –¥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞](../Screens/4.5_add_policy_user_result.png)

### –ö—Ä–æ–∫ 4: –ù–∞–¥–∞–Ω–Ω—è –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø—É (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)

**–í–∞—Ä—ñ–∞–Ω—Ç 1: –ü—Ä–∏–∫—Ä—ñ–ø–∏—Ç–∏ –≥–æ—Ç–æ–≤—É –ø–æ–ª—ñ—Ç–∏–∫—É (–ø—Ä–æ—Å—Ç—ñ—à–µ)**
1. **Attach existing policies directly**
2. –ó–Ω–∞–π–¥—ñ—Ç—å —ñ –æ–±–µ—Ä—ñ—Ç—å:
   - ‚úÖ `AmazonS3FullAccess`
   - ‚úÖ `AmazonEC2FullAccess` 
   - ‚úÖ `AmazonVPCFullAccess`
   - ‚úÖ `IAMReadOnlyAccess` (–¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó)

**–í–∞—Ä—ñ–∞–Ω—Ç 2: –°—Ç–≤–æ—Ä–∏—Ç–∏ –º—ñ–Ω—ñ–º–∞–ª—å–Ω—É –ø–æ–ª—ñ—Ç–∏–∫—É (–±–µ–∑–ø–µ—á–Ω—ñ—à–µ)**
–ü—Ä–∏–∫—Ä—ñ–ø–∏—Ç–∏ —Ç—ñ–ª—å–∫–∏ –Ω–∞—à—É –ø–æ–ª—ñ—Ç–∏–∫—É `S3AccessOnlyToSvitlanaKizilpinarBucket` + –¥–æ–¥–∞—Ç–∏ –ø–æ–ª—ñ—Ç–∏–∫–∏ –¥–ª—è EC2/VPC

### –ö—Ä–æ–∫ 3: –¢–µ–≥–∏ (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
- Key: `Purpose`, Value: `Terraform`
- Key: `Project`, Value: `VPC-Exercise`

### –ö—Ä–æ–∫ 4: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è
1. **Review** –≤—Å—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
2. **Create user**

### –ö—Ä–æ–∫ 5: –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è credentials
‚ö†Ô∏è **–ö–†–ò–¢–ò–ß–ù–û –í–ê–ñ–õ–ò–í–û**:
1. **–ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ .csv —Ñ–∞–π–ª** –∑ credentials
2. **–°–∫–æ–ø—ñ—é–π—Ç–µ Access Key ID —Ç–∞ Secret Access Key**
3. **–ó–±–µ—Ä–µ–∂—ñ—Ç—å —É –±–µ–∑–ø–µ—á–Ω–æ–º—É –º—ñ—Å—Ü—ñ**
4. **Secret Key –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –æ–¥–∏–Ω —Ä–∞–∑!**

## üîß –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è AWS CLI –¥–ª—è –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

### –í–∞—Ä—ñ–∞–Ω—Ç 1: –ù–æ–≤–∏–π –ø—Ä–æ—Ñ—ñ–ª—å (—Ä–µ–∫–æ–º–µ–Ω–¥—É—é)
```bash
aws configure --profile sk-terraform-user
```
–í–≤–µ–¥—ñ—Ç—å:
- **Access Key ID**: [–∑ –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞]
- **Secret Access Key**: [–∑ –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞]
- **Default region**: eu-central-1
- **Output format**: json

### –í–∞—Ä—ñ–∞–Ω—Ç 2: –ó–∞–º—ñ–Ω–∏—Ç–∏ default –ø—Ä–æ—Ñ—ñ–ª—å
```bash
aws configure
```

## ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–±–æ—Ç–∏

### –¢–µ—Å—Ç –¥–æ—Å—Ç—É–ø—É:
```bash
# –Ø–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ –ø—Ä–æ—Ñ—ñ–ª—å:
aws --profile sk-terraform-user s3 ls

# –Ø–∫—â–æ –∑–∞–º—ñ–Ω–∏–ª–∏ default:
aws s3 ls
```

### –¢–µ—Å—Ç S3 bucket:
```bash
aws --profile sk-terraform-user s3api head-bucket --bucket terraform-state-svitlana-vpc
```

## üîÑ –û–Ω–æ–≤–ª–µ–Ω–Ω—è Terraform

–ü—ñ—Å–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:
1. `terraform init -migrate-state`
2. –ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏ –∑ VPC —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è–º

## üõ°Ô∏è –ë–µ–∑–ø–µ–∫–∞

**–ü—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –ø—Ä–æ–µ–∫—Ç—É:**
- –î–µ–∞–∫—Ç–∏–≤—É–≤–∞—Ç–∏ Access Keys —Å—Ç–∞—Ä–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- –í–∏–¥–∞–ª–∏—Ç–∏ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ `sk-terraform-user`
- –í–∏–¥–∞–ª–∏—Ç–∏ S3 bucket —è–∫—â–æ –Ω–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω

---

**–ì–æ—Ç–æ–≤—ñ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞?** üöÄ